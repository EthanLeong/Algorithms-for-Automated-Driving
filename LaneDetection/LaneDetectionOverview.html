
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Overview &#8212; Algorithms for Automated Driving</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/car_sketch.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basics of Image Formation" href="CameraBasics.html" />
    <link rel="prev" title="Algorithms for Automated Driving" href="../Introduction/intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/car_sketch_wide.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Algorithms for Automated Driving</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Lane Detection
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CameraBasics.html">
   Basics of Image Formation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Segmentation.html">
   Lane Boundary Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="InversePerspectiveMapping.html">
   From Pixels to Meters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Discussion.html">
   Discussion
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Control
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Control/ControlOverview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Control/PID.html">
   PID Control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Control/BicycleModel.html">
   Kinematic Bicycle Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Control/PurePursuit.html">
   Pure Pursuit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Control/Discussion.html">
   Discussion
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Appendix/ExerciseSetup.html">
   Exercise Setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Appendix/CarlaInstallation.html">
   Carla Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Appendix/NextChapters.html">
   Future Chapters
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/LaneDetection/LaneDetectionOverview.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/thomasfermi/Algorithms-for-Automated-Driving"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/thomasfermi/Algorithms-for-Automated-Driving/issues/new?title=Issue%20on%20page%20%2FLaneDetection/LaneDetectionOverview.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/thomasfermi/Algorithms-for-Automated-Driving/edit/master/book/LaneDetection/LaneDetectionOverview.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lane-detection-system">
   Lane Detection System
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lane-boundary-segmentation-deep-learning">
   Lane Boundary Segmentation - Deep Learning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#from-pixels-to-meters-inverse-perspective-mapping">
   From pixels to meters - Inverse Perspective Mapping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outlook">
   Outlook
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="lane-detection-system">
<h2>Lane Detection System<a class="headerlink" href="#lane-detection-system" title="Permalink to this headline">¶</a></h2>
<p>In this chapter, I will guide you to build a simple but effective lane detection pipeline and apply it to images captured in the <a class="reference external" href="https://carla.org/">Carla Simulator</a>.
The pipeline takes an image as <em>input</em> and yields a mathematical model of the lane boundaries as an <em>output</em>.
The image is captured by a dashcam - a camera that is fixated behind the windshield of a vehicle. The lane boundary model is a polynomial</p>
<div class="math notranslate nohighlight">
\[
    y(x)=c_0+c_1 x+c_2 x^2 +c_3 x^3
\]</div>
<p>Here, both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are measured in meters. They define a coordinate system on the road as shown in <a class="reference internal" href="#model-iso8850"><span class="std std-numref">Fig. 1</span></a>.</p>
<div class="figure align-center" id="model-iso8850">
<a class="reference internal image-reference" href="../_images/iso8850_crop.png"><img alt="../_images/iso8850_crop.png" src="../_images/iso8850_crop.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Road coordinate system. The perspective is known as <em>bird’s eye view</em>.</span><a class="headerlink" href="#model-iso8850" title="Permalink to this image">¶</a></p>
</div>
<p>The pipeline consists of two steps</p>
<ul class="simple">
<li><p>Using a neural network, detect those pixels in an image that are lane boundaries</p></li>
<li><p>Associate the lane boundary pixels to points on the road, <span class="math notranslate nohighlight">\((x_i,y_i), i=0,1,2\dots\)</span>. Then fit a polynomial.</p></li>
</ul>
<p>The approach is inspired by the “baseline” method described in Ref. <a class="bibtex reference internal" href="#gansbeke2019endtoend" id="id1">[GBN+19]</a>, which performs close to state-of-the-art lane-detection methods.</p>
</div>
<div class="section" id="lane-boundary-segmentation-deep-learning">
<h2>Lane Boundary Segmentation - Deep Learning<a class="headerlink" href="#lane-boundary-segmentation-deep-learning" title="Permalink to this headline">¶</a></h2>
<p>In the chapter <a class="reference internal" href="Segmentation.html"><span class="doc std std-doc">Lane Boundary Segmentation</span></a>, we will train a neural network, which takes an image and estimates for each pixel the probability that it belongs to the left lane boundary, the probability that it belongs to the right lane boundary, and the probability that it belongs to neither. As you might know, a neural network needs data to learn. Luckily, it is easy to gather this data using the Carla simulator:
We are going to create a <em>vehicle</em> on the Carla map and attach an rgb camera <em>sensor</em> to it.
Then we will move the vehicle to different positions on the map and capture images with our camera.
The 3d world coordinates of the lane boundaries are obtained from the Carla simulator’s high definition map and can be projected into the image using the <em>pinhole camera model</em>.</p>
<div class="figure align-center" id="carla-lane-ground-truth">
<a class="reference internal image-reference" href="../_images/carla_lane_ground_truth.svg"><img alt="../_images/carla_lane_ground_truth.svg" src="../_images/carla_lane_ground_truth.svg" width="67%" /></a>
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">The Lane boundaries from Carla’s HD map are projected into the dashcam image (blue and orange).</span><a class="headerlink" href="#carla-lane-ground-truth" title="Permalink to this image">¶</a></p>
</div>
<p>For each simulation step, we save two separate images:</p>
<ul class="simple">
<li><p>The image captured by the dashcam</p></li>
<li><p>A <em>label image</em> that only consists of the projected lane boundaries</p></li>
</ul>
<p>You will learn how to create the label images in the chapter <a class="reference internal" href="CameraBasics.html"><span class="doc std std-doc">Basics of image formation</span></a>.</p>
</div>
<div class="section" id="from-pixels-to-meters-inverse-perspective-mapping">
<h2>From pixels to meters - Inverse Perspective Mapping<a class="headerlink" href="#from-pixels-to-meters-inverse-perspective-mapping" title="Permalink to this headline">¶</a></h2>
<p>A camera maps the three-dimensional world into a two-dimensional image plane. In general, it is not possible to take a single image and to reconstruct the three-dimensional coordinates of the objects depicted in that image. Using the <em>pinhole camera model</em>, we can reconstruct from which direction the light ray came, that was scattered off the depicted object, but not how many meters it has traveled.
This is different for the light that was scattered from the road into our camera sensor. Using the assumption that the road is flat, and our knowledge of the camera height and orientation with respect to the road, it is a basic geometry problem to compute the <span class="math notranslate nohighlight">\(x,y,z\)</span> position of each “road pixel” (<span class="math notranslate nohighlight">\(x,y,z\)</span> in meters!). This computation is known as <em>inverse perspective mapping</em> and you will learn about it in the chapter <a class="reference internal" href="InversePerspectiveMapping.html"><span class="doc std std-doc">From Pixels to Meters</span></a>.</p>
<p>From our deep learning model we have a list of probabilities <span class="math notranslate nohighlight">\(p_i(\textrm{left boundary}), i=0,1,2, \dots\)</span> for all the pixels. Using <em>inverse perspective mapping</em> we can even write down a list of tuples <span class="math notranslate nohighlight">\((x_i,y_i,p_i(\textrm{left boundary})), i=0,1,2, \dots\)</span>, since we know the road coordinates <span class="math notranslate nohighlight">\((x_i,y_i)\)</span> of each pixel.</p>
<p>We can now filter this list and throw away all tuples where <span class="math notranslate nohighlight">\(p_i(\textrm{left boundary})\)</span> is small. The filtered list of <span class="math notranslate nohighlight">\((x_i,y_i)\)</span> can be fed into a method for polynomial fitting, which will result in a polynomial <span class="math notranslate nohighlight">\(y(x)=c_0+c_1 x+c_2 x^2 +c_3 x^3\)</span> describing the left lane boundary. The same procedure is repeated for the right boundary.</p>
</div>
<div class="section" id="outlook">
<h2>Outlook<a class="headerlink" href="#outlook" title="Permalink to this headline">¶</a></h2>
<p>Once you have finished all exercises of this chapter, you will have implemented a python class <code class="docutils literal notranslate"><span class="pre">LaneDetector</span></code> that can yield lane boundary polynomials <span class="math notranslate nohighlight">\(y_l(x), y_r(x)\)</span> for the left and right lane boundary, given an image from a dashcam in the Carla simulator.
In the next chapter, we will write a lane-keeping system for a vehicle in the Carla simulator. This lane-keeping system needs the desired speed and a reference path as inputs. You can take the centerline between the lane boundaries that your <code class="docutils literal notranslate"><span class="pre">LaneDetector</span></code> class computes, and feed that into your lane-keeping system.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-LaneDetection/LaneDetectionOverview-0"><dl class="citation">
<dt class="bibtex label" id="gansbeke2019endtoend"><span class="brackets"><a class="fn-backref" href="#id1">GBN+19</a></span></dt>
<dd><p>Wouter Van Gansbeke, Bert De Brabandere, Davy Neven, Marc Proesmans, and Luc Van Gool. End-to-end lane detection through differentiable least-squares fitting. 2019. <a class="reference external" href="https://arxiv.org/abs/1902.00293">arXiv:1902.00293</a>.</p>
</dd>
</dl>
</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "thomasfermi/Algorithms-for-Automated-Driving",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./LaneDetection"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../Introduction/intro.html" title="previous page">Algorithms for Automated Driving</a>
    <a class='right-next' id="next-link" href="CameraBasics.html" title="next page">Basics of Image Formation</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Mario Theers<br/>
        
          <div class="extra_footer">
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-183782120-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>